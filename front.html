<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Khmer Sentiment Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Kantumruy+Pro:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', 'Kantumruy Pro', sans-serif; }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-indigo-100 text-slate-800">

<header class="py-14 text-center bg-gradient-to-r from-indigo-100 via-sky-100 to-purple-100">
  <div class="max-w-3xl mx-auto bg-white/70 backdrop-blur-md rounded-2xl shadow-md px-6 py-8 border border-slate-200">
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-indigo-700">
      ğŸ‡°ğŸ‡­ Khmer Sentiment Analysis
    </h1>
    <p class="mt-4 text-lg text-slate-600">
      Deep Learning sentiment detection for Khmer language
    </p>
  </div>
</header>

<main class="max-w-5xl mx-auto px-6 pb-16 -mt-8">

    <div class="bg-white rounded-2xl shadow-lg p-8 border border-slate-200">
      <label class="block text-lg font-semibold mb-3 text-slate-700">
        âœï¸ Enter Khmer Text
      </label>

      <textarea
        id="textInput"
        rows="4"
        class="w-full bg-slate-50 border border-slate-300 rounded-xl p-4 text-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-all"
        placeholder="á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘á—á¶áŸá¶ááŸ’á˜áŸ‚ášá“áŸ…á‘á¸á“áŸáŸ‡..."
      ></textarea>

      <div class="flex flex-wrap gap-4 mt-6">
        <button
          onclick="analyzeSentiment()"
          id="analyzeBtn"
          class="flex items-center gap-2 px-8 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-indigo-600 to-sky-600 hover:shadow-lg hover:scale-105 active:scale-95 transition-all disabled:opacity-50"
        >
          <span id="btnText">ğŸ” Analyze Sentiment</span>
        </button>

        <button
          onclick="clearText()"
          class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold bg-slate-100 text-slate-700 hover:bg-slate-200 transition"
        >
          ğŸ§¹ Clear
        </button>
      </div>
    </div>

    <div
      id="resultBox"
      class="mt-10 hidden bg-white rounded-2xl shadow-xl p-8 border border-slate-200 animate-in fade-in slide-in-from-bottom-4 duration-500"
    >
      <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
        <h2 class="text-3xl font-bold flex items-center gap-2 text-slate-800">
            ğŸ“Š Result: <span id="mainLabel" class="">---</span>
        </h2>
        <div class="px-4 py-2 rounded-full bg-slate-100 text-slate-700 font-medium">
            Confidence: <span id="confidenceValue" class="font-bold text-indigo-600">0%</span>
        </div>
      </div>

      <div class="bg-slate-50 rounded-xl p-4 mb-8 border-l-4 border-indigo-400">
        <p class="text-sm uppercase tracking-wider font-semibold text-slate-500 mb-1">Original Text</p>
        <p id="resultText" class="text-lg italic text-slate-700"></p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">

        <div id="card-positive" class="rounded-xl p-6 bg-slate-50 border border-slate-200 transition-all duration-300">
          <p class="text-lg font-semibold text-slate-600">ğŸ˜Š POSITIVE</p>
          <p id="posScore" class="text-3xl font-bold mt-2 text-slate-400">0%</p>
        </div>

        <div id="card-neutral" class="rounded-xl p-6 bg-slate-50 border border-slate-200 transition-all duration-300">
          <p class="text-lg font-semibold text-slate-600">ğŸ˜ NEUTRAL</p>
          <p id="neuScore" class="text-3xl font-bold mt-2 text-slate-400">0%</p>
        </div>

        <div id="card-negative" class="rounded-xl p-6 bg-slate-50 border border-slate-200 transition-all duration-300">
          <p class="text-lg font-semibold text-slate-600">ğŸ˜¡ NEGATIVE</p>
          <p id="negScore" class="text-3xl font-bold mt-2 text-slate-400">0%</p>
        </div>

      </div>
    </div>

</main>

<script>
    async function analyzeSentiment() {
        const textInput = document.getElementById("textInput");
        const btn = document.getElementById("analyzeBtn");
        const btnText = document.getElementById("btnText");
        const resultBox = document.getElementById("resultBox");
        
        const text = textInput.value.trim();
        if (!text) {
            alert("Please enter some Khmer text first.");
            return;
        }

        // UI State: Loading
        btn.disabled = true;
        btnText.innerText = "âŒ› Analyzing...";
        
        try {
            const response = await fetch('/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            });

            if (!response.ok) throw new Error("Backend server error");

            const data = await response.json();

            // Update Text & Confidence
            document.getElementById("resultText").innerText = text;
            document.getElementById("confidenceValue").innerText = data.confidence + "%";
            
            // Update Main Label & Color
            const mainLabel = document.getElementById("mainLabel");
            mainLabel.innerText = data.label.toUpperCase();
            
            // Reset Colors first
            resetColors();

            // Apply specific styles based on prediction
            if (data.label === 'positive') {
                mainLabel.className = "text-emerald-600";
                highlightCard('card-positive', 'emerald');
            } else if (data.label === 'negative') {
                mainLabel.className = "text-red-600";
                highlightCard('card-negative', 'red');
            } else {
                mainLabel.className = "text-yellow-600";
                highlightCard('card-neutral', 'yellow');
            }

            // Update Percentage Scores
            document.getElementById("posScore").innerText = data.scores.positive + "%";
            document.getElementById("neuScore").innerText = data.scores.neutral + "%";
            document.getElementById("negScore").innerText = data.scores.negative + "%";

            // Show Box
            resultBox.classList.remove("hidden");
            resultBox.scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            console.error("Error:", error);
            alert("Could not connect to the Python backend. Make sure main.py is running on port 8000.");
        } finally {
            btn.disabled = false;
            btnText.innerText = "ğŸ” Analyze Sentiment";
        }
    }

    function highlightCard(id, color) {
        const card = document.getElementById(id);
        const score = card.querySelector('p:last-child');
        const title = card.querySelector('p:first-child');

        if (color === 'emerald') {
            card.className = "rounded-xl p-6 bg-emerald-50 border-2 border-emerald-400 shadow-md scale-105 transition-all";
            score.className = "text-3xl font-bold mt-2 text-emerald-600";
            title.className = "text-lg font-semibold text-emerald-700";
        } else if (color === 'red') {
            card.className = "rounded-xl p-6 bg-red-50 border-2 border-red-400 shadow-md scale-105 transition-all";
            score.className = "text-3xl font-bold mt-2 text-red-600";
            title.className = "text-lg font-semibold text-red-700";
        } else {
            card.className = "rounded-xl p-6 bg-yellow-50 border-2 border-yellow-400 shadow-md scale-105 transition-all";
            score.className = "text-3xl font-bold mt-2 text-yellow-600";
            title.className = "text-lg font-semibold text-yellow-700";
        }
    }

    function resetColors() {
        ['card-positive', 'card-neutral', 'card-negative'].forEach(id => {
            const card = document.getElementById(id);
            card.className = "rounded-xl p-6 bg-slate-50 border border-slate-200 transition-all";
            card.querySelector('p:last-child').className = "text-3xl font-bold mt-2 text-slate-400";
            card.querySelector('p:first-child').className = "text-lg font-semibold text-slate-600";
        });
    }

    function clearText() {
        document.getElementById("textInput").value = "";
        document.getElementById("resultBox").classList.add("hidden");
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>

</body>
</html>